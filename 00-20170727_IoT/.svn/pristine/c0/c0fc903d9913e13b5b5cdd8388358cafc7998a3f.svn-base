<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"   
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">  
<mapper namespace="edu.hnu.csee.luo.dao.UserDao">
 <resultMap id="BaseResultMap" type="edu.hnu.csee.luo.model.User" >
    <id column="userId" property="userId" jdbcType="INTEGER" />
    <result column="userName" property="userName" jdbcType="VARCHAR" />
    <result column="userGroupId" property="userGroupId" jdbcType="VARCHAR" />
    <result column="departmentId" property="departmentId" jdbcType="VARCHAR" />
    <result column="tel" property="tel" jdbcType="VARCHAR" />
    <result column="email" property="email" jdbcType="VARCHAR" />
    <result column="userAuth" property="userAuth" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="startIndex" property="startIndex" jdbcType="INTEGER" />
   	<result column="pageSize" property="pageSize" jdbcType="INTEGER" />
    <association property="dep" javaType="edu.hnu.csee.luo.model.Department">
    	<id column="departmentId" property="departmentId"/>
    	<result column="departmentName" property="departmentName"/>
    	<result column="tel" property="tel"/>
    </association>
    <association property="userlogin" column="userlogin" javaType="edu.hnu.csee.luo.model.UserLogin">
    	<id column="userId" property="userId"/>
    	<result column="userName" property="userName"/>
    </association>
</resultMap>



<select id="queryAllUserInfo" parameterType="edu.hnu.csee.luo.model.User" resultMap="BaseResultMap">
	SELECT 
 	u.userId,u.userName,ul.userName,d.departmentName,u.tel,u.email,u.userAuth,u.remark
 	FROM user_info u left join dep_info d
 	ON u.departmentId = d.departmentId
 	left join user_login ul
 	ON u.userId = ul.userId
</select>

<select id="queryUserInfo" parameterType="edu.hnu.csee.luo.model.User" resultMap="BaseResultMap">
	SELECT 
 	u.userId,u.userName,ul.userName,d.departmentName,u.tel,u.email,u.userAuth,u.remark
 	FROM user_info u left join dep_info d
 	ON u.departmentId = d.departmentId
 	left join user_login ul
 	ON u.userId = ul.userId
 	<where>  
	 	<if test="1==1">
	 		1=1
	 	</if>
        <if test="userName!=null and userName!='' ">     
           and u.userName = #{userName}      
        </if>    
         <if test="dep !=null and dep.departmentName!=null and dep.departmentName!='' ">     
           and d.departmentName = #{dep.departmentName}      
        </if>  
    </where>  
   limit #{paging.begin},#{paging.pageSize}
</select>

<select id="queryUserCount" parameterType="edu.hnu.csee.luo.model.User"  resultType="java.lang.Integer" >  
    SELECT 
 	count(*)
 	FROM user_info
</select> 

 <insert id="insertOneUser" parameterType="edu.hnu.csee.luo.model.User" >
    insert into user_info
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="userId != null" >
        userId,
      </if>
      <if test="userName != null" >
        userName,
      </if>
      <if test="userGroupId != null" >
        userGroupId,
      </if>
      <if test="departmentId != null" >
        departmentId,
      </if>
      <if test="tel != null" >
        tel,
      </if>
      <if test="email != null" >
        email,
      </if>
      <if test="userAuth != null" >
        userAuth,
      </if>
      <if test="remark != null" >
        remark,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="userId != null" >
        #{userId,jdbcType=INTEGER},
      </if>
      <if test="userName != null" >
        #{userName,jdbcType=VARCHAR},
      </if>
      <if test="userGroupId != null" >
        #{userGroupId,jdbcType=VARCHAR},
      </if>
      <if test="departmentId != null" >
        #{departmentId,jdbcType=VARCHAR},
      </if>
      <if test="tel != null" >
        #{tel,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="userAuth != null" >
        #{userauth,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
    </trim>
  </insert>
  <update id="updateUserInfo" parameterType="edu.hnu.csee.luo.model.User" >
    update user_info
    <set >
      <if test="userName != null" >
        userName = #{userName,jdbcType=VARCHAR},
      </if>
      <if test="userGroupId != null" >
        userGroupId = #{userGroupId,jdbcType=VARCHAR},
      </if>
      <if test="departmentId != null" >
        departmentId = #{departmentId,jdbcType=VARCHAR},
      </if>
      <if test="tel != null" >
        tel = #{tel,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="userAuth != null" >
        userAuth = #{userAuth,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
    </set>
    where userId = #{userId,jdbcType=INTEGER}
  </update>
  
   <update id="editUserInfo" parameterType="edu.hnu.csee.luo.model.User" >
    update user_info
    <set >
      <if test="userGroupId != null" >
        userGroupId = #{userGroupId,jdbcType=VARCHAR},
      </if>
      <if test="departmentId != null" >
        departmentId = #{departmentId,jdbcType=VARCHAR},
      </if>
      <if test="tel != null" >
        tel = #{tel,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        email = #{email,jdbcType=VARCHAR},
      </if>
      <if test="userAuth != null" >
        userAuth = #{userAuth,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
    </set>
    where userName = #{userName,jdbcType=VARCHAR}
  </update>
  
   <delete id="deleteUserById" parameterType="java.lang.Integer" >
    delete from user_info
    where userId = #{userId,jdbcType=INTEGER}
  </delete>

</mapper>